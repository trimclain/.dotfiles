#!/usr/bin/env bash

###############################################################################
# Wallpaper Setter
#
# Description: Set new (random) wallpaper
# Dependencies: waypaper, feh (for X11), hyprpaper (for Wayland)
###############################################################################

if [[ -d $HOME/personal/media/wallpapers ]]; then
    wallpapers="$HOME/personal/media/wallpapers"
elif [[ -d $HOME/wallpapers/ ]]; then
    wallpapers="$HOME/wallpapers"
else
    echo "Error: wallpapers not found"
    exit 2
fi

ensure_installed() {
    if ! command -v "$1" > /dev/null; then
        echo "Error: $1 not found"
        exit 1
    fi
}

ensure_installed waypaper

FLAGS=()

if [[ "$1" == "-r" || "$1" == "--random" ]]; then
    FLAGS+=(--random)
fi

if [[ -n $WAYLAND_DISPLAY ]]; then
    ensure_installed hyprpaper
    FLAGS+=(--backend hyprpaper)
else
    ensure_installed feh
    FLAGS+=(--backend feh)
fi

waypaper "${FLAGS[@]}" --folder "$wallpapers" > /dev/null &
