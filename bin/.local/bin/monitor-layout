#!/usr/bin/env bash

# TODO: settings second monitor as primary need to reload awesome config,
# resolution changed, awesome didn't notice

# TODO: when first and second monitor have different resolutions, don't use auto,
# use their resolution instead

# TODO: when duplicating monitors with different resolutions, using auto also
# doesn't work.

# TODO: if detected connected monitor, automatically make it the main one (or
# other options when I fix them)

## Functions
check_if_command_exists() {
    if ! command -v "$1" > /dev/null; then
        echo "Error: $1 not found"
        exit 1
    fi
}
## End Functions

check_if_command_exists xrandr

# get info from xrandr
connectedOutputs=$(xrandr | awk '$2 == "connected"{print $1}')
# activeOutput=$(xrandr | grep -E " connected (primary )?[1-9]+" | sed -e "s/\([A-Z0-9]\+\) connected.*/\1/")

monitors=()
for display in $connectedOutputs; do
    monitors+=($display)
done

intern=${monitors[0]}
extern=${monitors[1]}

if [ "$1" = "--first" ]; then
    # Enable first monitor, turn off second one
    xrandr --output "$intern" --auto --output "$extern" --off
elif [ "$1" = "--second" ]; then
    # Enable second monitor and make it primary, disable first monitor
    xrandr --output "$extern" --auto --primary --output "$intern" --off
elif [ "$1" = "--dual" ]; then
    # Enable dual monitor setup, primary is the monitor, which was primary before
    xrandr --output "$extern" --auto --right-of "$intern" --output "$intern" --auto
elif [ "$1" = "--duplicate" ]; then
    # Enable duplicate monitor setup
    xrandr --output "$extern" --same-as "$intern" --auto
fi
