#!/bin/sh

## Functions
check_if_command_exists() {
    if ! command -v "$1" > /dev/null; then
        echo "Error: $1 not found"
        exit 1
    fi
}
## End Functions

check_if_command_exists notify-send
check_if_command_exists pactl

mode="unknown"

# Increase Volume
if [ "$1" = "--increase" ]; then
    mode="increase"
    # Set Volume
    pactl set-sink-volume @DEFAULT_SINK@ +5%

# Decrease Volume
elif [ "$1" = "--decrease" ]; then
    mode="decrease"
    # Set Volume
    pactl set-sink-volume @DEFAULT_SINK@ -5%
elif [ "$1" = "--toggle-mute" ]; then
    # Toggle Mute Volume
    pactl set-sink-mute @DEFAULT_SINK@ toggle
    status=$(pactl get-sink-mute @DEFAULT_SINK@ | awk '/Mute/ { print $2 }')
    if [ "$status" = "no" ]; then
        mode="unmuted"
    elif [ "$status" = "yes" ]; then
        mode="muted"
    fi
fi

# Send notification
# output=$(pactl list sinks | grep '^[[:space:]]Volume:' | head -n $(( $SINK + 1 )) | tail -n 1 | sed -e 's,.* \([0-9][0-9]*\)%.*,\1,')
# TODO: does this work on ubuntu?
output=$(pactl get-sink-volume @DEFAULT_SINK@ | awk '{print $5}' | awk -F '%' '{ print $1 }')
if  [ "$mode" = "increase" ]; then
    notify-send " $output %" -t 350
elif [ "$mode" = "decrease" ]; then
    notify-send "奔 $output %" -t 350
elif [ "$mode" = "muted" ]; then
    notify-send "婢 $output %" -t 450
elif [ "$mode" = "unmuted" ]; then
    notify-send " $output %" -t 450
else
    notify-send 'Error: something went wrong' -t 500
fi
