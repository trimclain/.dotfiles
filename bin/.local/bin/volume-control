#!/bin/sh

## Functions
check_if_command_exists() {
    if ! command -v "$1" > /dev/null; then
        echo "Error: $1 not found"
        exit 1
    fi
}

get_volume() {
    pactl get-sink-volume @DEFAULT_SINK@ | awk '{print $5}' | awk -F '%' '{ print $1 }'
}

## End Functions

check_if_command_exists notify-send

check_if_command_exists pactl
VOLUME_UP="pactl set-sink-volume @DEFAULT_SINK@ +5%"
VOLUME_DOWN="pactl set-sink-volume @DEFAULT_SINK@ -5%"
VOLUME_MUTE="pactl set-sink-mute @DEFAULT_SINK@ toggle"
# MUTED_STATUS=

# Use alsa-utils instead of pactl if found
# if command -v amixer > /dev/null; then
#     VOLUME_UP="amixer -q sset Master 5%+ unmute"
#     VOLUME_DOWN="amixer -q sset Master 5%- unmute"
#     VOLUME_MUTE="amixer -q sset Master toggle"
# fi

mode="unknown"

# Increase Volume
if [ "$1" = "--increase" ]; then
    mode="increase"
    $VOLUME_UP

# Decrease Volume
elif [ "$1" = "--decrease" ]; then
    mode="decrease"
    $VOLUME_DOWN
elif [ "$1" = "--toggle-mute" ]; then
    # Toggle Mute Volume
    $VOLUME_MUTE
    status=$(pactl get-sink-mute @DEFAULT_SINK@ | awk '/Mute/ { print $2 }')
    if [ "$status" = "no" ]; then
        mode="unmuted"
    elif [ "$status" = "yes" ]; then
        mode="muted"
    fi
fi


output=$(get_volume)
# Write new volume to a file so it can be read less resource intensive
echo "$output%" > ~/.actual_volume

# Send notification
if  [ "$mode" = "increase" ]; then
    notify-send " $output %" -t 350
elif [ "$mode" = "decrease" ]; then
    notify-send "奔 $output %" -t 350
elif [ "$mode" = "muted" ]; then
    notify-send "婢 $output %" -t 450
elif [ "$mode" = "unmuted" ]; then
    notify-send " $output %" -t 450
else
    notify-send 'Error: something went wrong' -t 500
fi
