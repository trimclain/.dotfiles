#!/usr/bin/env python3

import os
from pathlib import Path
import subprocess

STOW_FOLDERS = [
    'bin',
    'bash',
    'i3',
    'awesome',
    'polybar',
    'nvim',
    'chtsh',
    'tmux',
    'vim',
    'zsh',
    'kitty',
    'alacritty',
    'rofi',
    'picom',
    'lf',
    'stylua',
]

STOW_CONFIGS = [
    '',
    '.bashrc',
    '.config/i3',
    '.config/awesome',
    '.config/polybar',
    '.config/nvim',
    '',
    '.tmux.conf',
    '.vimrc',
    '.zshrc',
    '.config/kitty',
    '.config/alacritty',
    '.config/rofi',
    '.config/picom',
    '.config/lf',
    '.config/.stylua.toml',
]

STOW_ARRAY = dict(zip(STOW_FOLDERS, STOW_CONFIGS))


# TODO: do I want this?
# if [[ -n $DOTFILES ]]; then
# if os.getenv('DOTFILES')

# TODO: handle the ones with no configs


def unstow():
    did_smth = False
    for folder, config in STOW_ARRAY.items():
        configpath = os.path.join(Path.home(), config)
        # check if file/foldr exists and is a symlink
        if os.path.islink(configpath):
            subprocess.run(['stow', '-D', folder])
            print('Removing symlink to', folder)
            did_smth = True
    if did_smth:
        print('Done')
    else:
        print('There are no jobs')


if __name__ == '__main__':
    # TODO: handle the case with no stow
    # if not os.path.isfile('/usr/bin/stow'):
    #     print('Stow not found! Install stow and relaunch the script.')
    #     sys.exit()
    unstow()
